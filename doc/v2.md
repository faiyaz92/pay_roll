## Insurance Management System

### 8.1 Insurance Types & Categories

The system supports multiple insurance types that can be active simultaneously for a single vehicle, following Australian insurance regulations:

#### Primary Insurance Types (Maximum 4 per vehicle)
- **Fix Insurance**: Fixed insurance coverage for vehicle protection (monthly payments)
- **REGO**: Registration and government compliance insurance (yearly)
- **Green Slip**: Compulsory third-party personal injury insurance (yearly)
- **Pink Slip**: Vehicle ownership and title insurance (yearly)

### 8.2 Insurance Policy Rules

#### Multi-Insurance Support
- **Maximum 4 Types**: A vehicle can have up to 4 different insurance types active simultaneously
- **Same Period Coverage**: Different insurance types can cover the same time period (e.g., Jan 1 - Dec 31 for all 4 types)
- **No Duplicate Types**: Cannot have two policies of the same type overlapping in time
- **Flexible Coverage**: Each insurance type maintains independent coverage periods

#### Valid Combinations
```
Vehicle XYZ can have (same period):
✅ Fix Insurance (Jan 1 - Jan 31) + REGO (Jan 1 - Dec 31) + Green Slip (Jan 1 - Dec 31) + Pink Slip (Jan 1 - Dec 31)

❌ REGO (Jan 1 - Dec 31) + REGO (Feb 1 - Dec 31) [Duplicate type overlapping]
❌ Fix Insurance (Jan 1 - Jan 31) + Fix Insurance (Feb 1 - Feb 28) [Duplicate type overlapping]
```

#### Overlap Prevention Logic
- **Type-Based Restriction**: System prevents adding a second policy of the same insurance type if dates overlap
- **Date Validation**: Checks existing policies of same type for date conflicts before allowing new additions
- **Error Message**: Clear feedback when attempting to add overlapping policies of same type

### 8.3 Insurance Expense Tracking

#### Periodic vs One-Time Payments
- **Fix Insurance**: Monthly payments (periodic) - prorated over coverage period
- **REGO/Green Slip/Pink Slip**: Yearly payments (one-time) - full amount recorded annually

#### Expense Calculation Examples
```typescript
// Fix Insurance (Monthly) - ₹12,000 annual premium
const monthlyExpense = 12000 / 12; // = ₹1,000/month

// REGO (Yearly) - ₹5,000 annual premium
const yearlyExpense = 5000; // = ₹5,000 one-time
```

### 8.4 Insurance Document Management

#### Required Documents by Type
- **Fix Insurance**: Policy copy, payment receipts
- **REGO**: Registration certificate, government receipts
- **Green Slip**: Compulsory insurance certificate
- **Pink Slip**: Ownership documents, title insurance

#### Document Storage
- **Cloudinary Integration**: Secure cloud storage for all insurance documents
- **Type Organization**: Documents categorized by insurance type and vehicle
- **Easy Retrieval**: Quick access for policy verification and claims

### 8.5 Implementation Notes

#### Data Storage
- **Expense Collection**: All insurance policies stored as expense records with `expenseType: 'insurance'`
- **Policy Details**: Full insurance information stored in `insuranceDetails` object within expense records
- **Vehicle Updates**: Latest insurance information reflected in vehicle document fields (for display purposes only)

#### Validation Logic
- **Pre-Submission Check**: Before saving, system queries existing expenses for same vehicle and insurance type
- **Date Overlap Detection**: Uses standard date overlap algorithm to prevent conflicts
- **User Feedback**: Toast notifications for validation errors and successful additions

#### Business Rules
- **Expense Tracking**: Correct approach - insurance as expenses maintains financial audit trail
- **No Vehicle Overwrite**: Vehicle document shows latest policy but doesn't restrict multiple policies
- **Audit Compliance**: Full history of all insurance transactions maintained in expenses collection